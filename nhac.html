<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Music Player - Kang & Thy</title>

<style>
    :root {
        --bg-main: linear-gradient(135deg, #1a1a1a, #3d002f);
        --primary: #ff87c9;
        --accent: #ff4fab;
        --border: #ff8ccd;
        --text-main: #ffffff;
        --text-soft: #ffbde6;
        --disc-border: #ffb6d9;
        --disc-glow: #ff7ac4;
        --dropdown-bg: #3d002f;
        --dropdown-text: #ffffff;
    }

    body {
        margin: 0; padding: 0;
        background: var(--bg-main);
        font-family: 'Segoe UI', sans-serif;
        color: var(--text-main);
        height: 100vh;
        display: flex;
        overflow: hidden;
    }

    /* --- Giao di·ªán ch√≠nh --- */
    #mainUI {
        display: flex;
        width: 100%;
        height: 100%;
        transition: opacity 1.5s ease, filter 1.5s ease;
    }

    .left-panel {
        width: 65%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: width 0.3s ease;
        position: relative;
    }
    
    .left-panel.full-width { width: 100%; }

    .disc-container {
        width: 260px; height: 260px;
        border-radius: 50%;
        background-color: #333; 
        background-repeat: no-repeat;
        background-position: center;
        background-size: cover;
        border: 6px solid var(--disc-border);
        box-shadow: 0 0 25px var(--disc-glow);
        animation: spin 4s linear infinite;
        animation-play-state: paused;
    }

    .playing .disc-container { animation-play-state: running; }

    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    .song-title {
        margin-top: 20px;
        font-size: 26px;
        font-weight: bold;
        text-align: center;
        color: var(--text-soft);
        transition: all 1s ease;
    }

    .song-desc {
        font-size: 14px; margin-top: 5px;
        opacity: 0.8; text-align: center;
        transition: all 1s ease;
    }

    .progress-container { width: 70%; max-width: 400px; margin-top: 30px; }
    .progress-bar { height: 8px; background: rgba(255, 255, 255, 0.2); border-radius: 4px; cursor: pointer; }
    .progress { height: 100%; width: 0%; background: var(--accent); border-radius: 4px; }
    .time-display { display: flex; justify-content: space-between; margin-top: 5px; font-size: 12px; opacity: 0.7; }
    
    .controls { margin-top: 20px; display: flex; gap: 12px; align-items: center; }
    .btn {
        width: 45px; height: 45px; border-radius: 50%;
        background: var(--primary); border: none; font-size: 18px;
        cursor: pointer; box-shadow: 0 0 10px var(--accent);
        transition: 0.2s; display: flex; align-items: center; justify-content: center;
    }
    #playBtn { width: 60px; height: 60px; font-size: 24px; }

    .playlist {
        width: 35%;
        background: rgba(255, 255, 255, 0.06);
        backdrop-filter: blur(10px);
        padding: 20px;
        display: flex;
        flex-direction: column;
        border-left: 2px solid var(--border);
        transition: transform 0.3s ease, width 0.3s ease;
    }
    
    .playlist.hidden { transform: translateX(100%); width: 0; padding: 0; border-left: none; }

    #playlistContent { flex-grow: 1; overflow-y: auto; margin-bottom: 15px; }

    /* D√≤ng th√¥ng tin b·∫£n quy·ªÅn */
    .copyright-info {
        font-size: 11px;
        text-align: center;
        padding: 10px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--text-soft);
        line-height: 1.4;
        opacity: 0.8;
    }

    .filter-control {
        width: 100%; padding: 10px; margin-bottom: 10px; 
        border: 1px solid var(--border); border-radius: 5px; 
        background: var(--dropdown-bg); color: var(--dropdown-text);
        box-sizing: border-box; outline: none;
    }
    .filter-control option { background: #3d002f; color: #ffffff; }

    .song-item {
        padding: 12px; margin-bottom: 10px;
        background: rgba(255, 182, 213, 0.15); border-radius: 10px;
        cursor: pointer; display: flex; justify-content: space-between; align-items: center;
    }
    .song-item.active { background: var(--accent) !important; }
    .song-details { flex-grow: 1; overflow: hidden; }
    .song-name { font-weight: bold; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; }
    .song-stats { font-size: 11px; color: var(--text-soft); margin-top: 4px; }
    .action-group { display: flex; gap: 5px; }
    .action-btn { background: rgba(255, 255, 255, 0.2); border: none; color: white; padding: 5px; border-radius: 4px; cursor: pointer; }

    /* N√∫t ƒëi·ªÅu h∆∞·ªõng g√≥c m√†n h√¨nh */
    #togglePlaylistBtn {
        position: absolute; top: 20px; right: 20px; 
        width: 45px; height: 45px; border-radius: 50%;
        background: var(--primary); border: none;
        cursor: pointer; z-index: 1000; color: white;
    }
    #themeSelector {
        position: absolute; top: 20px; left: 20px;
        padding: 6px 12px; border-radius: 20px; border: none;
        background: var(--primary); font-weight: bold; cursor: pointer;
    }
    #manualIdleBtn {
        position: absolute; bottom: 20px; left: 20px;
        width: 45px; height: 45px; border-radius: 50%;
        background: rgba(255, 255, 255, 0.1); border: 1px solid var(--border);
        color: white; cursor: pointer; z-index: 1000;
        display: flex; align-items: center; justify-content: center;
        transition: 0.3s;
    }
    #manualIdleBtn:hover { background: var(--accent); }

    /* --- CH·∫æ ƒê·ªò CH·ªú (IDLE MODE) --- */
    #idleOverlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.95);
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        opacity: 0; pointer-events: none; transition: opacity 2s ease;
        z-index: 9999;
    }
    #idleOverlay.active { opacity: 1; pointer-events: all; }
    #visualizer { width: 100%; height: 300px; position: absolute; bottom: 0; }
    .idle-info { text-align: center; z-index: 10001; }
    .idle-title { font-size: 60px; font-weight: bold; color: var(--primary); text-shadow: 0 0 20px var(--accent); margin: 0; }
    .idle-artist { font-size: 24px; color: var(--text-soft); margin-top: 10px; }
    .highlight-info { transform: scale(1.3); text-shadow: 0 0 30px var(--accent); }
</style>
</head>

<body>

<div id="idleOverlay" onclick="resetIdle()">
    <div class="idle-info">
        <p class="idle-title" id="idleTitle"></p>
        <p class="idle-artist" id="idleArtist"></p>
        <p style="font-size: 12px; margin-top: 30px; opacity: 0.5;">Nh·∫•n b·∫•t k·ª≥ ƒë√¢u ƒë·ªÉ quay l·∫°i</p>
    </div>
    <canvas id="visualizer"></canvas>
</div>

<div id="mainUI">
    <div class="left-panel" id="playerArea">
        <select id="themeSelector">
            <option value="default">üíó M·∫∑c ƒë·ªãnh</option>
            <option value="dark">üåô Dark</option>
            <option value="love">üíû Love</option>
            <option value="night">üåå Night</option>
        </select>

        <button id="togglePlaylistBtn" title="Danh s√°ch nh·∫°c">‚ò∞</button> 
        <button id="manualIdleBtn" title="B·∫≠t ch·∫ø ƒë·ªô ch·ªù" onclick="forceIdle()">üåô</button>

        <div class="disc-container" id="disc"></div>

        <div class="song-title" id="songTitle">ƒêang t·∫£i...</div>
        <div class="song-desc" id="songDesc"></div>
        
        <div class="progress-container">
            <div class="progress-bar" id="progressBar">
                <div class="progress" id="progress"></div>
            </div>
            <div class="time-display">
                <span id="currentTime">0:00</span>
                <span id="durationTime">0:00</span>
            </div>
        </div>

        <div class="controls">
            <button class="btn" id="prevBtn">‚èÆ</button>
            <button class="btn" id="shuffleBtn">üîÄ</button>
            <button class="btn" id="playBtn">‚ñ∂Ô∏è</button>
            <button class="btn" id="downloadBtn">üì•</button>
            <button class="btn" id="shareBtn">üîó</button>
            <button class="btn" id="nextBtn">‚è≠</button>
        </div>
    </div>

    <div class="playlist" id="playlist">
        <h2 style="text-align: center; font-size: 1.2rem;">DANH S√ÅCH B√ÄI H√ÅT</h2>
        <input type="text" id="searchInput" placeholder="T√¨m b√†i h√°t..." onkeyup="filterSongs()" class="filter-control">
        <select id="genreFilter" onchange="filterSongs()" class="filter-control"></select>
        
        <div id="playlistContent"></div>

        <div class="copyright-info">
            M·ªçi b√†i h√°t ƒë·ªÅu ƒë∆∞·ª£c s√°ng t√°c b·ªüi <strong>ONEKANG</strong><br>
            Chi ti·∫øt b·∫£n quy·ªÅn li√™n h·ªá: <u>phanhuukhanh2612@gmail.com</u>
        </div>
    </div>
</div>

<audio id="audio" crossorigin="anonymous"></audio>

<script>
const STORAGE_KEY = 'kangthy_music_playlist';
let songs = [
    { title: "Anh ƒêang C·ªë", desc: "Lyrics: OneKang ‚Ä¢ Artist: Qu√¢nBy", file: "Anh ƒëang c·ªë.mp3", playCount: 6622, cover: "https://raw.githubusercontent.com/huukhanh2612/kangthy/41820ab49fc16eb49b50bdd822cdd496535b2843/Gemini_Generated_Image_m4gf0bm4gf0bm4gf.png", genre: "SUY" }, 
    { title: "Ng√†y ƒê√¥ng L·∫°nh", desc: "Lyrics: OneKang ‚Ä¢ Artist: Qu√¢nBy", file: "Ng√†y ƒë√¥ng l·∫°nh.mp3", playCount: 6622, cover: "https://raw.githubusercontent.com/huukhanh2612/kangthy/41820ab49fc16eb49b50bdd822cdd496535b2843/Gemini_Generated_Image_h1urogh1urogh1ur.png", genre: "SUY" }, 
    { title: "ƒê√™m D√†i", desc: "Lyrics: OneKang ‚Ä¢ Artist: Qu√¢nBy - OngKang - B·∫£o Black", file: "ƒê√™m D√†i.mp3", playCount: 6622, cover: "https://raw.githubusercontent.com/huukhanh2612/kangthy/0826d9dfab0e06384ce5e135b70f81be636c0a0d/z7300307998090_e88f094681988496cd7448fdca2a6dcc.jpg", genre: "D·ªÆ" },
    { title: "Xu√¥i Theo D√≤ng", desc: "Lyrics: OneKang ‚Ä¢ Artist: Qu√¢nBy", file: "Xu√¥i theo s√¥ng.mp3", playCount: 1123, cover: "https://raw.githubusercontent.com/huukhanh2612/kangthy/ee11147f7324130dfdae739dea2204f5c7f63917/diaquay.jpg", genre: "SUY" },
    { title: "ƒê·ªì Ngon", desc: "Lyrics: OneKang ‚Ä¢ Artist: B·∫£o Black", file: "ƒê·ªì Ngon.mp3", playCount: 1123, cover: "https://raw.githubusercontent.com/huukhanh2612/kangthy/0826d9dfab0e06384ce5e135b70f81be636c0a0d/z7300307221612_0bb54ca8ddc8a81765d57b4ba9785d7f.jpg", genre: "D·ªÆ" },
    { title: "K√©o Anh T√¥i Ra", desc: "Lyrics: OneKang ‚Ä¢ Artist: Rick", file: "K√©o Anh T√¥i Ra.mp3", playCount: 2124, cover: "https://raw.githubusercontent.com/huukhanh2612/kangthy/8f816a23e19e9041c7cf71b11a907a864c34c03e/photo_2025-03-04_18-40-42.jpg", genre: "C·ª®U" },
    { title: "Ch·∫°y Kh·ªèi Tao", desc: "Lyrics: OneKang ‚Ä¢ Artist: B·∫£o Black", file: "Ch·∫°y kh·ªèi tao.mp3", playCount: 3329, cover: "https://raw.githubusercontent.com/huukhanh2612/kangthy/ee11147f7324130dfdae739dea2204f5c7f63917/diaquay.jpg", genre: "SUY" },
    { title: "C√≤n Ngo·∫°i ƒê√¢u", desc: "Lyrics: OneKang ‚Ä¢ Artist: BB.A", file: "C√≤n ngo·∫°i ƒë√¢u _.mp3", playCount: 6442, cover: "https://raw.githubusercontent.com/huukhanh2612/kangthy/02005d4f3bd9cdd96bb59add285779b40576b5ad/z7280227127599_19b782c2166dab57ad1468f645d2f276.jpg", genre: "SUY" },
    { title: "Qu√™n Ngo·∫°i", desc: "Lyrics: OneKang ‚Ä¢ Artist: Qu√¢nBy", file: "Qu√™n Ngo·∫°i.mp3", playCount: 4244, cover: "https://raw.githubusercontent.com/huukhanh2612/kangthy/02005d4f3bd9cdd96bb59add285779b40576b5ad/z7280227127599_19b782c2166dab57ad1468f645d2f276.jpg", genre: "SUY" },
    { title: "Sao Em L·∫°i Ch·ªçn Kh√≥ KhƒÉn", desc: "Lyrics: OneKang ‚Ä¢ Artist: ƒê·∫°iTo", file: "Sao em l·∫°i ch·ªçn kh√≥ khƒÉn _.mp3", playCount: 6122, cover: "https://raw.githubusercontent.com/huukhanh2612/kangthy/02005d4f3bd9cdd96bb59add285779b40576b5ad/IMG_5366.JPG", genre: "SUY" }
];

let currentIndex = 0;
const audio = document.getElementById("audio");
const playBtn = document.getElementById("playBtn");
const playerArea = document.getElementById("playerArea");
const playlistContent = document.getElementById("playlistContent");

// --- LOGIC IDLE (CH·∫æ ƒê·ªò CH·ªú) ---
let idleTime = 0;
const idleLimit = 10; 
const mainUI = document.getElementById("mainUI");
const idleOverlay = document.getElementById("idleOverlay");
const songTitleUI = document.getElementById("songTitle");
const songDescUI = document.getElementById("songDesc");

function resetIdle() {
    idleTime = 0;
    mainUI.style.opacity = "1";
    mainUI.style.filter = "none";
    idleOverlay.classList.remove("active");
    songTitleUI.classList.remove("highlight-info");
    songDescUI.classList.remove("highlight-info");
}

function forceIdle() {
    if (audio.paused) {
        alert("Vui l√≤ng ph√°t nh·∫°c ƒë·ªÉ tr·∫£i nghi·ªám hi·ªáu ·ª©ng s√≥ng nh·∫°c!");
        return;
    }
    idleTime = idleLimit;
    activateIdle();
}

function activateIdle() {
    mainUI.style.opacity = "0";
    mainUI.style.filter = "blur(10px)";
    idleOverlay.classList.add("active");
    document.getElementById("idleTitle").innerText = songs[currentIndex].title;
    document.getElementById("idleArtist").innerText = songs[currentIndex].desc;
    startVisualizer();
}

window.onmousemove = resetIdle;
window.onkeydown = resetIdle;

setInterval(() => {
    if (!audio.paused && !idleOverlay.classList.contains("active")) {
        idleTime++;
        if (idleTime == 5) {
            songTitleUI.classList.add("highlight-info");
            songDescUI.classList.add("highlight-info");
        }
        if (idleTime >= idleLimit) activateIdle();
    }
}, 1000);

// --- VISUALIZER ---
let audioCtx, analyser, source, canvas, ctx, bufferLength, dataArray;
function startVisualizer() {
    if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioCtx.createAnalyser();
        source = audioCtx.createMediaElementSource(audio);
        source.connect(analyser);
        analyser.connect(audioCtx.destination);
        analyser.fftSize = 256;
        bufferLength = analyser.frequencyBinCount;
        dataArray = new Uint8Array(bufferLength);
        canvas = document.getElementById("visualizer");
        ctx = canvas.getContext("2d");
    }
    if (audioCtx.state === 'suspended') audioCtx.resume();
    draw();
}

function draw() {
    if (!idleOverlay.classList.contains("active")) return;
    requestAnimationFrame(draw);
    analyser.getByteFrequencyData(dataArray);
    canvas.width = window.innerWidth;
    canvas.height = 300;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const barWidth = (canvas.width / bufferLength) * 2.5;
    let barHeight;
    let x = 0;
    for (let i = 0; i < bufferLength; i++) {
        barHeight = dataArray[i] * 1.1;
        ctx.fillStyle = `rgba(255, 135, 201, ${barHeight/255})`;
        ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
        x += barWidth + 1;
    }
}

// --- LOGIC C∆† B·∫¢N ---
const themes = {
    default:{"--bg-main":"linear-gradient(135deg,#1a1a1a,#3d002f)","--primary":"#ff87c9","--accent":"#ff4fab","--border":"#ff8ccd","--text-main":"#fff","--text-soft":"#ffbde6","--disc-border":"#ffb6d9","--disc-glow":"#ff7ac4","--dropdown-bg":"#3d002f","--dropdown-text":"#ffffff"},
    dark:{"--bg-main":"linear-gradient(135deg,#000,#1a1a1a)","--primary":"#444","--accent":"#777","--border":"#333","--text-main":"#f5f5f5","--text-soft":"#ccc","--disc-border":"#555","--disc-glow":"#999","--dropdown-bg":"#1a1a1a","--dropdown-text":"#ffffff"},
    love:{"--bg-main":"linear-gradient(135deg,#ff4f8b,#ff9acb)","--primary":"#ff2f7d","--accent":"#ff66a3","--border":"#ffb6d9","--text-main":"#fff","--text-soft":"#fff0f7","--disc-border":"#fff","--disc-glow":"#ffb6d9","--dropdown-bg":"#ff4f8b","--dropdown-text":"#ffffff"},
    night:{"--bg-main":"linear-gradient(135deg,#0f2027,#203a43,#2c5364)","--primary":"#3fa9f5","--accent":"#00c6ff","--border":"#3fa9f5","--text-main":"#fff","--text-soft":"#ccefff","--disc-border":"#00c6ff","--disc-glow":"#3fa9f5","--dropdown-bg":"#203a43","--dropdown-text":"#ffffff"}
};

function applyTheme(t){
    Object.entries(themes[t]).forEach(([k,v])=> document.documentElement.style.setProperty(k,v));
    localStorage.setItem("kangthy_theme",t);
    document.getElementById("themeSelector").value = t;
}
document.getElementById("themeSelector").onchange=(e)=>applyTheme(e.target.value);
applyTheme(localStorage.getItem("kangthy_theme")||"default");

document.getElementById("togglePlaylistBtn").onclick = () => {
    document.getElementById("playlist").classList.toggle('hidden');
    playerArea.classList.toggle('full-width');
};

function updatePlaylistDisplay() {
    playlistContent.innerHTML = songs.map((song, i) => `
        <div class="song-item ${i === currentIndex ? 'active' : ''}" onclick="playSong(${i})">
            <div class="song-details">
                <div class="song-name">${song.title}</div>
                <div class="song-stats">L∆∞·ª£t nghe: ${Math.round(song.playCount)} | ${song.genre}</div>
            </div>
            <div class="action-group">
                <button class="action-btn" onclick="handleDownload(${i}, event)">üì•</button>
                <button class="action-btn" onclick="handleShare(${i}, event)">üîó</button>
            </div>
        </div>
    `).join('');
    filterSongs();
}

function loadSong(index) {
    currentIndex = index;
    const song = songs[currentIndex];
    audio.src = song.file;
    document.getElementById("songTitle").innerText = song.title;
    document.getElementById("songDesc").innerText = song.desc;
    document.getElementById("disc").style.backgroundImage = `url('${song.cover}')`;
    updatePlaylistDisplay();
}

function playSong(index) {
    loadSong(index);
    audio.play();
    playerArea.classList.add("playing");
    playBtn.textContent = '‚è∏Ô∏è';
}

playBtn.onclick = () => {
    if (audio.paused) {
        audio.play();
        playerArea.classList.add("playing");
        playBtn.textContent = '‚è∏Ô∏è';
    } else {
        audio.pause();
        playerArea.classList.remove("playing");
        playBtn.textContent = '‚ñ∂Ô∏è';
    }
};

document.getElementById("nextBtn").onclick = () => {
    currentIndex = (currentIndex + 1) % songs.length;
    playSong(currentIndex);
};

document.getElementById("prevBtn").onclick = () => {
    currentIndex = (currentIndex - 1 + songs.length) % songs.length;
    playSong(currentIndex);
};

function filterSongs() {
    const term = document.getElementById("searchInput").value.toLowerCase();
    const genre = document.getElementById("genreFilter").value;
    const items = document.querySelectorAll(".song-item");
    items.forEach((item, i) => {
        const s = songs[i];
        const matchTerm = s.title.toLowerCase().includes(term) || s.desc.toLowerCase().includes(term);
        const matchGenre = !genre || s.genre === genre;
        item.style.display = (matchTerm && matchGenre) ? "flex" : "none";
    });
}

function populateGenres() {
    const genres = ["", ...new Set(songs.map(s => s.genre))];
    document.getElementById("genreFilter").innerHTML = genres.map(g => `<option value="${g}">${g || "T·∫•t c·∫£ th·ªÉ lo·∫°i"}</option>`).join('');
}

audio.ontimeupdate = () => {
    if (audio.duration) {
        document.getElementById("progress").style.width = (audio.currentTime / audio.duration) * 100 + "%";
        document.getElementById("currentTime").innerText = formatTime(audio.currentTime);
    }
};
audio.onloadedmetadata = () => document.getElementById("durationTime").innerText = formatTime(audio.duration);
audio.onended = () => document.getElementById("nextBtn").click();
document.getElementById("progressBar").onclick = (e) => {
    audio.currentTime = (e.offsetX / e.target.clientWidth) * audio.duration;
};

populateGenres();
loadSong(0);
</script>
</body>
</html>
